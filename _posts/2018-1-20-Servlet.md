---
layout: post
title: "Servlet "
date: 2018-1-20
description: "Servlet "
tag: java-web
comments: true
---
[「引用地址」](http://www.runoob.com/jsp/jsp-architecture.html)~ 菜鸟教程 | jsp & servlet~

**!!!** : `本博客只属于个人资料及知识点的整理，权限归原网站所有，请移步原网址进行相关操作，谢谢`

## `base`: what is jsp

JSP 技术是以 Java 语言作为脚本语言的，JSP 网页为整个服务器端的 Java 库单元提供了一个接口来服务于HTTP的应用程序。

JSP是一种Java servlet，主要用于实现Java web应用程序的用户界面部分

JSP通过网页表单获取用户输入数据、访问数据库及其他数据源，然后动态地创建网页。

JSP标签有多种功能，比如访问数据库、记录用户选择信息、访问JavaBeans组件等，还可以在不同的网页中传递控制信息和共享信息。

### JSP程序与CGI程序

JSP程序与CGI程序有着相似的功能，但和CGI程序相比，JSP程序有如下优势：

性能更加优越，因为JSP可以直接在HTML网页中动态嵌入元素而不需要单独引用CGI文件。

服务器调用的是已经编译好的JSP文件，而不像CGI/Perl那样必须先载入解释器和目标脚本。

JSP 基于Java Servlet API，因此，JSP拥有各种强大的企业级Java API，包括JDBC，JNDI，EJB，JAXP等等。

JSP页面可以与处理业务逻辑的 Servlet 一起使用，这种模式被Java servlet 模板引擎所支持。

JSP是Java EE不可或缺的一部分，是一个完整的企业级应用平台。这意味着JSP可以用最简单的方式来实现最复杂的应用。

### JSP的优势
以下列出了使用JSP带来的其他好处：

与ASP相比：JSP有两大优势。首先，动态部分用Java编写，而不是VB或其他MS专用语言，所以更加强大与易用。第二点就是JSP易于移植到非MS平台上。

与纯 Servlet 相比：**JSP可以很方便的编写或者修改HTML网页而不用去面对大量的println语句。**

与SSI相比：SSI无法使用表单数据、无法进行数据库链接。

与JavaScript相比：虽然JavaScript可以在客户端动态生成HTML，但是很难与服务器交互，因此不能提供复杂的服务，比如访问数据库和图像处理等等。

与静态HTML相比：静态HTML不包含动态信息。

## JSP width servlet 结构

网络服务器需要一个 JSP 引擎，也就是一个容器来处理 JSP 页面。容器负责截获对 JSP 页面的请求。如内嵌 JSP 容器的 Apache 来支持 JSP 开发。

JSP 容器与 Web 服务器协同合作，为JSP的正常运行提供必要的运行环境和其他服务，并且能够正确识别专属于 JSP 网页的特殊元素。

![下图显示了 JSP 容器和 JSP 文件在 Web 应用中所处的位置。]({{ site.baseurl }}/post_imgs/jsp-arch.jpg)

### JSP 处理
- 就像其他普通的网页一样，您的浏览器发送一个 HTTP 请求给服务器。

- Web 服务器识别出这是一个对 JSP 网页的请求，并且将该请求传递给 JSP 引擎。通过使用 URL或者 .jsp 文件来完成。

- **JSP 引擎从磁盘中载入 JSP 文件，然后将它们转化为 Servlet。这种转化只是简单地将所有模板文本改用 println() 语句，并且将所有的 JSP 元素转化成 Java 代码。**

- **JSP 引擎将 Servlet 编译成可执行类，并且将原始请求传递给 Servlet 引擎。**

- **Web 服务器的某组件将会调用 Servlet 引擎，然后载入并执行 Servlet 类。在执行过程中，Servlet 产生 HTML 格式的输出并将其内嵌于 HTTP response 中上交给 Web 服务器。**

- Web 服务器以静态 HTML 网页的形式将 HTTP response 返回到您的浏览器中。

- 最终，Web 浏览器处理 HTTP response 中动态产生的HTML网页，就好像在处理静态网页一样。

![以上提及到的步骤可以用下图来表示：]({{ site.baseurl }}/post_imgs/jsp-processing.jpg)

一般情况下，JSP 引擎会检查 JSP 文件对应的 Servlet 是否已经存在，并且检查 JSP 文件的修改日期是否早于 Servlet。如果 JSP 文件的修改日期早于对应的 Servlet，那么容器就可以确定 JSP 文件没有被修改过并且 Servlet 有效。这使得整个流程与其他脚本语言（比如 PHP）相比要高效快捷一些。JSP 网页就是用另一种方式来编写 Servlet

### JSP 生命周期
JSP生命周期就是从创建到销毁的整个过程，类似于servlet生命周期，区别在于JSP生命周期还包括将JSP文件编译成servlet。

- 编译阶段：

    servlet容器编译servlet源文件，生成servlet类

    当浏览器请求JSP页面时，JSP引擎会首先去检查是否需要编译这个文件。如果这个文件没有被编译过，或者在上次编译后被更改过，则编译这个JSP文件。

    编译的过程包括三个步骤：

    - 解析JSP文件。
    - 将JSP文件转为servlet。
    - 编译servlet。

- 初始化阶段：
    加载与JSP对应的servlet类，创建其实例，并调用它的初始化方法

    容器载入JSP文件后，它会在为请求提供任何服务前调用jspInit()方法。如果您需要执行自定义的JSP初始化任务，复写jspInit()方法就行了，就像下面这样：

        public void jspInit(){
          // 初始化代码
        }

    一般来讲程序只初始化一次，servlet也是如此。通常情况下您可以在jspInit()方法中初始化数据库连接、打开文件和创建查询表。

- 执行阶段：
    调用与JSP对应的servlet实例的服务方法

    这一阶段描述了JSP生命周期中一切与请求相关的交互行为，直到被销毁。

    当JSP网页完成初始化后，JSP引擎将会调用_jspService()方法。

    `_jspService()`方法需要一个HttpServletRequest对象和一个HttpServletResponse对象作为它的参数，就像下面这样：

        ```java
        void _jspService(HttpServletRequest request,
                         HttpServletResponse response)
        {
           // 服务端处理代码
        }
        ```

    `_jspService()`方法在每个request中被调用一次并且负责产生与之相对应的response，并且它还负责产生所有7个HTTP方法的回应，比如GET、POST、DELETE等等。

- 销毁阶段：
    调用与JSP对应的servlet实例的销毁方法，然后销毁servlet实例

    JSP生命周期的销毁阶段描述了当一个JSP网页从容器中被移除时所发生的一切。

    jspDestroy()方法在JSP中等价于servlet中的销毁方法。当您需要执行任何清理工作时复写jspDestroy()方法，比如释放数据库连接或者关闭文件夹等等。

    jspDestroy()方法的格式如下：

        ```java
        public void jspDestroy()
        {
           // 清理代码
        }
        ```
![]({{ site.baseurl }}/post_imgs/jsp_life_cycle.jpg)

## `base`: what is servlet

Java Servlet 是运行在 Web 服务器或应用服务器上的程序，它是作为来自 Web 浏览器或其他 HTTP 客户端的请求和 HTTP 服务器上的数据库或应用程序之间的中间层。

使用 Servlet，您可以收集来自网页表单的用户输入，呈现来自数据库或者其他源的记录，还可以动态创建网页。

Java Servlet 通常情况下与使用 CGI（Common Gateway Interface，公共网关接口）实现的程序可以达到异曲同工的效果。但是相比于 CGI，Servlet 有以下几点优势：

性能明显更好。
Servlet 在 Web 服务器的地址空间内执行。这样它就没有必要再创建一个单独的进程来处理每个客户端请求。
Servlet 是独立于平台的，因为它们是用 Java 编写的。
服务器上的 Java 安全管理器执行了一系列限制，以保护服务器计算机上的资源。因此，Servlet 是可信的。
Java 类库的全部功能对 Servlet 来说都是可用的。它可以通过 sockets 和 RMI 机制与 applets、数据库或其他软件进行交互。

![]({{ site.baseurl }}/post_imgs/servlet-arch.jpg)
### Servlet 任务
Servlet 执行以下主要任务：

读取客户端（浏览器）发送的显式的数据。这包括网页上的 HTML 表单，或者也可以是来自 applet 或自定义的 HTTP 客户端程序的表单。
读取客户端（浏览器）发送的隐式的 HTTP 请求数据。这包括 cookies、媒体类型和浏览器能理解的压缩格式等等。
处理数据并生成结果。这个过程可能需要访问数据库，执行 RMI 或 CORBA 调用，调用 Web 服务，或者直接计算得出对应的响应。
发送显式的数据（即文档）到客户端（浏览器）。该文档的格式可以是多种多样的，包括文本文件（HTML 或 XML）、二进制文件（GIF 图像）、Excel 等。
发送隐式的 HTTP 响应到客户端（浏览器）。这包括告诉浏览器或其他客户端被返回的文档类型（例如 HTML），设置 cookies 和缓存参数，以及其他类似的任务。
### Servlet 包
Java Servlet 是运行在带有支持 Java Servlet 规范的解释器的 web 服务器上的 Java 类。

Servlet 可以使用 javax.servlet 和 javax.servlet.http 包创建，它是 Java 企业版的标准组成部分，Java 企业版是支持大型开发项目的 Java 类库的扩展版本。

这些类实现 Java Servlet 和 JSP 规范。当前文章二者相应的版本分别是 Java Servlet 2.5 和 JSP 2.1。

Java Servlet 就像任何其他的 Java 类一样已经被创建和编译。在您安装 Servlet 包并把它们添加到您的计算机上的 Classpath 类路径中之后，您就可以通过 JDK 的 Java 编译器或任何其他编译器来编译 Servlet。
